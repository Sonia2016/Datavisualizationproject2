<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JS Bin</title>
</head>
<body>
<button type="button" onclick=showNewWords(myWordCloud,1)>Person</button>
<button type="button" onclick=showNewWords(myWordCloud,3)>Location</button>
<button type="button" onclick=showNewWords(myWordCloud,0)>Organization</button>
<button type="button" onclick=showNewWords(myWordCloud,2)>Miscellaneous</button>
</body>

</html>
 <script src="http://d3js.org/d3.v3.min.js"></script>
 <script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>
<script>
	/*jshint asi:true laxcomma:true expr:true boss:true eqnull:true*/
var doc = document
var extend = function(a, b) {
  Object.keys(b).forEach(function(k){a[k] = b[k]})
  return a
}
var elem = function(tag, props) {
  return extend(doc.createElement(tag), props)
}
/**
 * @param words {Array}
 * @returns {Object} Frequency of words per length
 */
var frequency = function(words) {
  return words.filter(Boolean).reduce(function(acc, x) {
    for(var i = 0 ; i < x.length; i++){
      if(x[i] != "")
       acc[x[i]] = ++acc[x[i]] || 1;}
      return acc;
  },{})
}
var empty = function(x) {
  while (x.hasChildNodes())
    x.removeChild(x.lastChild)
  return x
}
/**
 * @param freq {Object} Frequence of words per length
 * @returns {Node} Document fragment
 */
var max = 0;
var array_value=0;
function assign_array_value(i)
{
	array_value=i;
	showNewWords(myWordCloud, i);
}
var resultOf = function(freq) {
  return Object.keys(freq).reduce(function(frag, k) {
    frag.appendChild(elem('p', {
        textContent: 'Words with '+ k +' chars: '+ freq[k]
    }))
    return frag
  }, doc.createDocumentFragment())
}
var textarea = doc.getElementById('text')
var button = doc.getElementById('analyse')
var result = doc.getElementById('results')
function highFrequency(words){
  var wordfreq = {};
  var higwords;
  var max = 0 ; 
   for(var i = 0 ; i < 50 ; i++){
    for(var w in words){
          if(words[w] > max){
            max = words[w];
            higwords = w;
            wordfreq[higwords] = max;
          }
        }
        delete words[higwords];
        max = 0;
   }
  return wordfreq;
}
var blogs;
var topOrganization = [];
var topPerson = [];
var topLocation = [];
var topMiscellaneous = [];
var top50Org =[""];
var top50Per =[""];
var top50Loc =[""];
var top50Mis =[""];
d3.tsv("wikinews.tsv", function(error, data) {
  data.forEach(function(d) {
      d.time = d3.time.format("%Y-%m-%d").parse(d.time.slice(0,10));
    });
 
  blogs =  d3.keys(data[0]).slice(1).map(function(id) {
    return {
      id: id,
      values: data.map(function(d) {
        return {time: d.time, person: d.person, location:d.location, organization:d.organization, miscellaneous:d.miscellaneous};
      })
    };
  });
  // console.log(blogs);
  for(var b in blogs){
    for(var i = 0 ; i < blogs[b].values.length; i++){
      topOrganization.push(blogs[b].values[i].organization.split('|'));
      topLocation.push(blogs[b].values[i].location.split('|'));
      topMiscellaneous.push(blogs[b].values[i].miscellaneous.split('|'));
      topPerson.push(blogs[b].values[i].person.split('|'));
    }
  }
  topOrganization = frequency(topOrganization);
  topPerson = frequency(topPerson);
  topLocation = frequency(topLocation);
  topMiscellaneous = frequency(topMiscellaneous);
  top50Location = highFrequency(topLocation);
  top50Person = highFrequency(topPerson);
  top50Miscellaneous = highFrequency(topMiscellaneous);
  top50Organization =  highFrequency(topOrganization);
  
  console.log(top50Location);
  console.log(top50Person);
  console.log(top50Miscellaneous);
  console.log(top50Organization);
	
	// For loop to put hashmap data into the array
	for (var key in top50Location)
	{
		top50Loc[0]=top50Loc[0]+""+key+" "+top50Location[key]+"|";
	}
	for (var key in top50Person)
	{
		top50Per[0]=top50Per[0]+""+key+" "+top50Person[key]+"|";
	}
	for (var key in top50Miscellaneous)
	{
		top50Mis[0]=top50Mis[0]+""+key+" "+top50Miscellaneous[key]+"|";
	}
	for (var key in top50Organization)
	{
		top50Org[0]=top50Org[0]+""+key+" "+top50Organization[key]+"|";
	}
	//console.log("Org "+top50Org[0]);
	//console.log("Per "+top50Per[0]);
	//console.log("Loc "+top50Loc[0]);
	//console.log("Mis "+top50Mis[0]);
	showNewWords(myWordCloud);
});
var words =[""];
// Encapsulate the word cloud functionality
function wordCloud(selector) {

    var fill = d3.scale.category20();
	//Construct the word cloud's SVG element
    var svg = d3.select(selector).append("svg")
        .attr("width", 800)
        .attr("height", 600)
        .append("g")
        .attr("transform", "translate(250,250)");


    //Draw the word cloud
    function draw(words) {
        var cloud = svg.selectAll("g text")
                        .data(words, function(d) { return d.text; })

        //Entering words
        cloud.enter()
            .append("text")
            .style("font-family", "Impact")
            .style("fill", function(d, i) { return fill(i); })
            .attr("text-anchor", "middle")
            .attr('font-size', 1)
            .text(function(d) { return d.text; });

        //Entering and existing words
        cloud
            .transition()
                .duration(600)
                .style("font-size", function(d) { return d.size + "px"; })
                .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                    //return "translate(" + [d.x, d.y] + ")";//rotate(" + d.rotate + ")";
                })
                .style("fill-opacity", 1);

        //Exiting words
        cloud.exit()
            .transition()
                .duration(200)
                .style('fill-opacity', 1e-6)
                .attr('font-size', 1)
                .remove();
    }


    //Use the module pattern to encapsulate the visualisation code. We'll
    // expose only the parts that need to be public.
    return {

        //Recompute the word cloud for a new set of words. This method will
        // asycnhronously call draw when the layout has been computed.
        //The outside world will need to call this function, so make it part
        // of the wordCloud return value.
        update: function(words) {
            d3.layout.cloud().size([500, 500])
                .words(words)
                .padding(5)
                .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .font("Impact")
                .fontSize(function(d) { return d.size; })
                .on("end", draw)
                .start();
        }
    }

}

//Prepare one of the sample sentences by removing punctuation,
// creating an array of words and computing a random size attribute.
function getWords(i) {
	//debugger;
    return words[i]
            .replace(/[!\.,:;\?"]/g, '')
            .split('|')
            .map(function(d) {
				return {text: d, size: 10 + Math.random() * 60};
            })
}

//This method tells the word cloud to redraw with a new set of words.
//In reality the new words would probably come from a server request,
// user input or some other source.
function showNewWords(vis, i) {
    i = i || 0;
    //i = array_value;
	words[0]=top50Org[0]
	words[1]=top50Per[0]
	words[2]=top50Mis[0]
	words[3]=top50Loc[0];
	console.log(i);
    vis.update(getWords(i))
    //vis.update(getWords(i ++ % words.length))
   //setTimeout(function() { showNewWords(vis, i + 1)}, 2000)
}

//Create a new instance of the word cloud visualisation.
var myWordCloud = wordCloud('body');

//Start cycling through the demo data


</script>
